var Calendar=function(options){
	this.wrap=document.querySelector(options.wrap);
	this.callback=options.callback || null;
	this.curDate();
	this.addEvent();
}
Calendar.prototype={
	getDays:function(date){
		var year=date.getFullYear(),
			month=date.getMonth()+1,
			days;
		if(month==1||month==3||month==5||month==7||month==8||month==10||month==12){
			days=31;
		}else if(month==2){
			days= year%400==0||year%100!=0&&year%4==0 ? 29:28;
		}else{
			days=30;
		}
		return days;
	},
	siblingsDays:function(step,date){
		var sibYear=date.getFullYear(),
			sibMonth=date.getMonth()+step,
			sibDate=new Date(sibYear,sibMonth,1),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
			sibDays=this.getDays(new Date(sibDate));
		return sibDays;
	},
	setDays:function(date){
			this.cur=this.getDays(date);
			this.prev=this.siblingsDays(-1,date);
	},
	curDate:function(){
		this.ltYear=new Date().getFullYear();
		this.ltDay=new Date().getDate();
		this.ltMonth=new Date().getMonth(),
		this.times=new Date().getTime();
	},
	render:function(selDate){
		this.selDate=selDate;
		this.setDays(selDate)
		var year=selDate.getFullYear(),
			month=selDate.getMonth(),
			day=selDate.getDate();
		this.startWeek=new Date(year,month,1).getDay();
		var str='<p class="calendar-title"><a href="javascript:;" class="prev"></a>'+year+'年'+(month+1)+'月'+'<a href="javascript:;" class="next"></a></p>'+
				'<div class="weekday clear"><span>周日</span><span>周一</span><span>周二</span><span>周三</span><span>周四</span><span>周五</span><span>周六</span></div><div class="cur-month clear">';
		var s_arr=[];
		for(i=1;i<=this.startWeek;i++){
			s_arr.unshift('<span class="sib"></span>')
		}
		str+=s_arr.join("");
		for(j=1;j<=this.cur;j++){
			if(j==day && month==this.ltMonth && year==this.ltYear){
				str+='<span class="now cur-day" data-time="'+year+','+(month+1)+','+j+'">'+j+'</span>'
			}else if((month<this.ltMonth && year==this.ltYear) || year<this.ltYear || (j<this.ltDay && month==this.ltMonth && year==this.ltYear)){
				str+='<span>'+j+'</span>'
			}else{
				str+='<span class="cur-day" data-time="'+year+','+(month+1)+','+j+'">'+j+'</span>'
			}
		}
		var lastDay=42-this.startWeek-this.cur;
		for(j=1;j<=lastDay;j++){
			str+='<span></span>'
		}
		str+='</div></div>'
		this.wrap.innerHTML=str;
		if((month<=this.ltMonth && year==this.ltYear) || year<this.ltYear){
			console.log('小于当前月份，不能点击');
			$('.prev').on('click',function(){
				return false;
			})
		}
	},
	newDate:function(){
		return $('#calendar').find('.now').data('time');
	},
	addEvent:function(){
		var that=this;
		$('#calendar').on('click','.cur-day',function(){
			$(this).addClass('now').siblings().removeClass('now');
		}).on('click','.prev',function(){
			that.siblingsMonth(-1)
		}).on('click','.next',function(){
			that.siblingsMonth(+1)
		})
	},
	siblingsMonth:function(s){
		var prevDays=this.siblingsDays(s,this.selDate),
			prevDate=new Date(this.selDate.getTime()+(s*86400000*prevDays));
		this.render(prevDate);
	}
}
